### 为什么要分用户态和内核态

---

最主要的原因是**权限分级**。

**Cpu指令**

指令集是软件操作硬件的媒介。

每一条汇编语句，对应一条指令。

很多个指令汇聚在一起，就是指令集。



Cpu指令是有权限分级的，有些指令是操作硬件的，如果操作的不规范，会影响到整个系统。

硬件的操作是复杂的，可能会出问题的。因此操作系统禁止软件直接操作硬件的可能，只能通过系统调用来简介操作硬件。



### 用户态和系统态

---

用户态和系统态就是权限分级的结果，系统态是高权限，用户态是低权限。

用户态需要使用高权限的指令，只能通过切换到高权限的指令。

比如进程要处理IO，进程会执行函数切换到系统态，

用户态切换到系统态是比较耗费资源的，它需要完成 ：

- 保留用户态执行的现场
- 复制用户态参数，并检查参数是否有危害
- 执行内核态代码
- 复制执行结果，切换到用户态
- 恢复用户态现场【寄存器、上下文、用户栈】



**触发用户态切换到系统态的情况**

1. 系统调用 ：比如fork函数
2. 中断 ：外围设备完成请求后，会向CPU发送中断信号，CPU会转到中断信号对应的进程中去处理
3. 异常 ：如缺页异常